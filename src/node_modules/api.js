const base = "https://js.kristjankivikangur21.thkit.ee";

function send ({ method, path, data, token }) {
    const fetch = process.browser ? window.fetch : require('node-fetch').default;

    const opts = {method, headers: {}};

    if (data) {
        opts.headers['Content-Type'] = 'application/json';
        opts.body = JSON.stringify(data);
    }
    if (token) {
        opts.headers['Authorization'] = `Bearer ${token}`;
    }

    console.log(`${base}/${path}`);
    console.log(opts);
    return fetch(`${base}/${path}`, opts)
    .then(res => {
        console.log('Response status:', res.status);
        return res.json().then(jsonData => {
            console.log('Response data:', jsonData);
            return jsonData;
        });
    })
    .catch(error => {
        console.error('API Error:', error);
        return { error: error.message || 'Network error occurred' };
    });
}

export function get (path, token) {
    return send({ method: 'GET', path, token });
}

export function del (path, token) {
    return send({ method: 'DELETE', path, token });
}

export function post (path, data, token) {
    return send({ method: 'POST', path, data, token });
}

export function put (path, data, token) {
    return send({ method: 'PUT', path, data, token });
}